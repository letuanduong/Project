<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Game bắn bóng</title>
    <style type = "text/css">
        canvas {
            background-color: rgb(126, 179, 170);
        }
        output {
            width: 100px;
            height: 30px;
            background-color:  chocolate;
        }
    </style>
</head>
<body onkeydown="keyPressHandler(event)">
    <table colspan="30" style="background: chocolate">
        <tr>
            <td>
                SCORE: <output id = "score" value ="0" name ="SCORE"></output>
            </td>
        </tr>
    </table>
    <canvas id = "canvas" style="border: 3px solid #000000;"></canvas>
    <script>

        let canvas = document.getElementById('canvas');
        let ctx = canvas.getContext('2d');
        let dx = 2;
        let dy = 2;
        let flag  = [];
        let count = [0];
        //Khung trò chơi=>>>>>>>
        const GameSpeed = 12;
        const CanvasHeight = 400;
        const CanvasWidth = 500;
        //giá trị bóng=>>>>>>>>
        const LocationBallWidth = 15;
        const LocationBallHeight = 15;
        const BallRadian = 15;
        //giá trị tấm bar=>>>>>       
        const LocationBarWidth = 400;
        const LocationBarHeight = 390;
        const BarWidth = 100;
        const BarHeight = 10;
        //==============================Nhận sự kiện từ bàn phím====================
        function keyPressHandler(event) {
            const KEY_LEFT = 37;
            const KEY_RIGHT = 39;        
            switch (event.keyCode) {
                case KEY_RIGHT: {
                    flag[0] = true;
                    break;
                }         
                case KEY_LEFT: {
                    flag[1] = true;                  
                    break;
                }
            }
        }
        //===============================Lớp khung trò chơi============================
        let classGameBoard = function(width, height) {
            this.width = width;
            this.height = height;
            canvas.width = this.width;
            canvas.height = this.height;           
        }
        //===================================class Bóng================================
        let classBall = function(x, y, radian) {
            this.x = x;
            this.y = y;
            this.radian = radian;
            this.draw = function() {
                let canvas = document.getElementById('canvas');
                let ctx = canvas.getContext('2d');
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radian, 0, 2*Math.PI);
                ctx.fillStyle = "blue";
                ctx.fill();
                ctx.stroke(); 
            }
            this.methodMove = function(dx, dy) {
                this.dx = dx;
                this.dy = dy;
                this.x += dx;
                this.y += dy;
            }
        }  
         //====================================class Bar===================================  
        let classBar = function(x, y, barWidth, barHeight) {
            const dx = 15;
            this.x = x;
            this.y = y;  
            this.barWidth = barWidth;
            this.barHeight = barHeight; 
            this.moveRight = function() {
                this.x += dx;         
            }
            this.moveLeft = function() {
                this.x -= dx;
            }
            this.draw = function() {
                let canvas = document.getElementById('canvas');
                let ctx = canvas.getContext('2d');
                ctx.fillStyle = "blue";
                ctx.fillRect(this.x, this.y, this.barWidth, this.barHeight);
            }
        }
        //===========================Hàm kiểm tra điều kiện chiến thắng=========================
        function collisionDetection() {
            if(ball.x + ball.radian > canvas.width || ball.x < ball.radian) {
                dx = -dx;  
            }
            if(ball.y < ball.radian) {
                dy = -dy;
            }
            if (ball.y + ball.radian < canvas.height) {
                if (ball.x > bar.x && ball.x < bar.x + bar.barWidth) {
                    if(ball.y + ball.radian > canvas.height - bar.barHeight) {
                        ball.y = ball.y - bar.barHeight;
                        dy = -dy;
                        count[0]++;
                    }    
                }   
            } else {
                alert("GAME OVER");
                document.location.reload();
                clearInterval(interval); 
            }
        }
        //==============================Bắt đầu trò chơi=================================
        //===============================================================================
        let board = new classGameBoard(CanvasWidth, CanvasHeight);
        let bar = new classBar(LocationBarWidth, LocationBarHeight, BarWidth, BarHeight);
        let ball = new classBall(LocationBallWidth, LocationBallHeight, BallRadian);    
        function Start() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);                      
            bar.draw();
            ball.draw();  
            ball.methodMove(dx, dy);
            collisionDetection();            
            if(flag[0]) {
                if(bar.x + bar.barWidth < canvas.width) {
                    bar.moveRight();
                    flag[0] = false;
                }
            }
            if(flag[1]) {
                if(bar.x > 0) {
                    bar.moveLeft();
                    flag[1] = false;
                }
            }                           
            document.getElementById('score').innerHTML = count[0];
        }
        var interval = setInterval(Start, GameSpeed);         
    </script>
</body>
</html>